{{extend 'layout.html'}}

<button type="button" class="btn btn-info" data-toggle="collapse" data-target="#form">{{=T('Filter')}}</button>
<div id="form" class="collapse">
  {{=form.custom.begin}}
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-2">
        {{=T('UniqueID')}}: <div>{{=form.custom.widget.cgr_ids}}</div>
        {{=T('Not UniqueId')}}: <div>{{=form.custom.widget.not_cgr_ids}}</div>
      </div>
      <div class="col-md-2">
        {{=form.custom.label.origin_hosts}}: <div>{{=form.custom.widget.origin_hosts}}</div>
        {{=form.custom.label.not_origin_hosts}}: <div>{{=form.custom.widget.not_origin_hosts}}</div>
      </div>
      <div class="col-md-2">
        {{=form.custom.label.sources}}: <div>{{=form.custom.widget.sources}}</div>
        {{=form.custom.label.not_sources}}: <div>{{=form.custom.widget.not_sources}}</div>
      </div>
      <div class="col-md-2">
        {{=form.custom.label.destination_prefixes}}: <div>{{=form.custom.widget.destination_prefixes}}</div>
        {{=form.custom.label.not_destination_prefixes}}: <div>{{=form.custom.widget.not_destination_prefixes}}</div>
      </div>
      <div class="col-md-2">
        {{=form.custom.label.suppliers}}: <div>{{=form.custom.widget.suppliers}}</div>
        {{=form.custom.label.not_suppliers}}: <div>{{=form.custom.widget.not_suppliers}}</div>
      </div>
    </div>
    <a href="#" data-toggle="collapse" data-target="#time-fields">{{=T('Time Fields')}}</a><br/>
    <div id="time-fields" class="row collapse">
      <div class="col-md-2">
        {{=form.custom.label.setup_time_start}}: <div>{{=form.custom.widget.setup_time_start}}</div>
        {{=form.custom.label.setup_time_end}}: <div>{{=form.custom.widget.setup_time_end}}</div>
      </div>
      <div class="col-md-2">
        {{=form.custom.label.answer_time_start}}: <div>{{=form.custom.widget.answer_time_start}}</div>
        {{=form.custom.label.answer_time_end}}: <div>{{=form.custom.widget.answer_time_end}}</div>
      </div>
      <div class="col-md-2">
        {{=form.custom.label.created_at_start}}: <div>{{=form.custom.widget.created_at_start}}</div>
        {{=form.custom.label.created_at_end}}: <div>{{=form.custom.widget.created_at_end}}</div>
      </div>
      <div class="col-md-2">
        {{=form.custom.label.updated_at_start}}: <div>{{=form.custom.widget.updated_at_start}}</div>
        {{=form.custom.label.updated_at_end}}: <div>{{=form.custom.widget.updated_at_end}}</div>
      </div>
    </div>
    <a href="#" data-toggle="collapse" data-target="#cost-fields">{{=T('Cost Fields')}}</a><br/>
    <div id="cost-fields" class="row collapse">
      <div class="col-md-2">
        {{=form.custom.label.disconnect_causes}}: <div>{{=form.custom.widget.disconnect_causes}}</div>
        {{=form.custom.label.not_disconnect_causes}}: <div>{{=form.custom.widget.not_disconnect_causes}}</div>
      </div>
      <div class="col-md-2">
        {{=form.custom.label.costs}}: <div>{{=form.custom.widget.costs}}</div>
        {{=form.custom.label.not_costs}}: <div>{{=form.custom.widget.not_costs}}</div>
      </div>
      <div class="col-md-2">
        {{=form.custom.label.extra_fields}}: <div>{{=form.custom.widget.extra_fields}}</div>
        {{=form.custom.label.not_extra_fields}}: <div>{{=form.custom.widget.not_extra_fields}}</div>
      </div>
      <div class="col-md-2">
        {{=form.custom.label.order_id_start}}: <div>{{=form.custom.widget.order_id_start}}</div>
        {{=form.custom.label.order_id_end}}: <div>{{=form.custom.widget.order_id_end}}</div>
      </div>
    </div>
    <a href="#" data-toggle="collapse" data-target="#min-max-fields">{{=T('Min-Max Fields')}}</a><br/>
    <div id="min-max-fields" class="row collapse">
      <div class="col-md-2">
        {{=form.custom.label.min_usage}}: <div>{{=form.custom.widget.min_usage}}</div>
        {{=form.custom.label.max_usage}}: <div>{{=form.custom.widget.max_usage}}</div>
      </div>
      <div class="col-md-2">
        {{=form.custom.label.min_pdd}}: <div>{{=form.custom.widget.min_pdd}}</div>
        {{=form.custom.label.max_pdd}}: <div>{{=form.custom.widget.max_pdd}}</div>
      </div>
      <div class="col-md-2">
        {{=form.custom.label.min_cost}}: <div>{{=form.custom.widget.min_cost}}</div>
        {{=form.custom.label.max_cost}}: <div>{{=form.custom.widget.max_cost}}</div>
      </div>
    </div>
    {{if auth.has_membership('admin'):}}
    <a href="#" data-toggle="collapse" data-target="#admin-fields">{{=T('Admin Fields')}}</a><br/>
    <div id="admin-fields" class="row collapse">
      <div class="col-md-2">
        {{=form.custom.label.run_ids}}: <div>{{=form.custom.widget.run_ids}}</div>
        {{=form.custom.label.not_run_ids}}: <div>{{=form.custom.widget.not_run_ids}}</div>
      </div>
      <div class="col-md-2">
        {{=form.custom.label.tenants}}: <div>{{=form.custom.widget.tenants}}</div>
        {{=form.custom.label.not_tenants}}: <div>{{=form.custom.widget.not_tenants}}</div>
      </div>
      <div class="col-md-2">
        {{=form.custom.label.accounts}}: <div>{{=form.custom.widget.accounts}}</div>
        {{=form.custom.label.not_accounts}}: <div>{{=form.custom.widget.not_accounts}}</div>
      </div>
      <div class="col-md-2">
        {{=form.custom.label.subjects}}: <div>{{=form.custom.widget.subjects}}</div>
        {{=form.custom.label.not_subjects}}: <div>{{=form.custom.widget.not_subjects}}</div>
      </div>
    </div>
    {{pass}}
    {{=form.custom.submit}}
  </div>
  {{=form.custom.end}}
</div>

{{if params:}}
<h4>{{=T('Filters')}}</h4>
<ul>
  {{for key, value in params.iteritems():}}
  <li>{{=key}}: {{=value}}</li>
  {{pass}}
</ul>
{{pass}}

<table class="table">
  <thead>
    <tr>
      <th>{{=T('UniqueId')}}</th>
      {{if auth.has_membership('admin'):}}
      <th>{{=T('RunId')}}</th>
      {{pass}}
      <th>{{=T('OrderID')}}</th>
      <th>{{=T('OriginHost')}}</th>
      <th>{{=T('Source')}}</th>
      <th>{{=T('OriginID')}}</th>
      {{if auth.has_membership('admin'):}}
      <th>{{=T('Tenant')}}</th>
      <th>{{=T('Account')}}</th>
      {{pass}}
      <th>{{=T('Subject')}}</th>
      <th>{{=T('Destination')}}</th>
      <th>{{=T('SetupTime')}}</th>
      <th>{{=T('AnswerTime')}}</th>
      <th>{{=T('PDD')}}</th>
      <th>{{=T('Usage')}}</th>
      <th>{{=T('DisconnectCause')}}</th>
      <th>{{=T('Cost')}}</th>
      <th>{{=T('ExtraFields')}}</th>
      <th>{{=T('CostDetails')}}</th>
      <th>{{=T('')}}</th>
    </tr>
  </thead>
  <tbody>
    {{for i,cdr in enumerate(cdrs):}}
    {{if i==items_per_page: break}}
    <tr>
      <td>{{=cdr['CGRID']}}</td>
      {{if auth.has_membership('admin'):}}
      <td>{{=cdr['RunID']}}</td>
      {{pass}}
      <td>{{=cdr['OrderID']}}</td>
      <td>{{=cdr['OriginHost']}}</td>
      <td>{{=cdr['Source']}}</td>
      <td>{{=cdr['OriginID']}}</td>
      {{if auth.has_membership('admin'):}}
      <td>{{=cdr['Tenant']}}</td>
      <td>{{=cdr['Account']}}</td>
      {{pass}}
      <td>{{=cdr['Subject']}}</td>
      <td>{{=cdr['Destination']}}</td>
      <td>{{=cdr['SetupTime']}}</td>
      <td>{{=cdr['AnswerTime']}}</td>
      <td>{{=cdr['PDD']}}</td>
      <td>{{=cdr['Usage']}}</td>
      <td>{{=cdr['DisconnectCause']}}</td>
      <td>{{=cdr['Cost']}}</td>
      <td>
        <a href="#" data-toggle="collapse" data-target="#extra-fields-{{=i}}">{{=T('show')}}</a><br/>
        <div id="extra-fields-{{=i}}" class="collapse">
          {{=cdr['ExtraFields']}}
        </div>
      </td>
      <td>
        <a href="#" data-toggle="collapse" data-target="#cost-details-fields-{{=i}}">{{=T('show')}}</a><br/>
        <div id="cost-details-fields-{{=i}}" class="collapse">
          {{=cdr['CostDetails']}}
        </div>
      </td>
    </tr>
    {{pass}}
  </tbody>
</table>
{{if page:}}
<a href="{{=URL(args=[client.id, page-1])}}">previous</a>
{{pass}}

{{if len(cdrs)>items_per_page:}}
<a href="{{=URL(args=[client.id, page+1])}}">next</a>
{{pass}}
